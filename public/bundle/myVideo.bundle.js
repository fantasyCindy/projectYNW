!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="/public/bundle/",t(0)}([function(e,t,n){"use strict";var r=n(1).getInstance();n(6),$(function(){yn.centerMenu.init({render:"my",light:"我的视频"}),r.onCrop=function(e){$.post("/teacher/html/uploadImg.htm",{dataImg:e,user_id:ynUserId},function(e){if("success"!=e.status)return layer.msg("错误:"+e);var t=e.returnPath;$("#videoCover").attr("src",t)},"json")},i.init(),i.render(),o.init()});var i=function(){var e,t,n,r,i={page:1,row:10,isDraft:0},a=function(e){e=_.extend({teacherid:ynTeacherId,page:1,row:10,isDraft:0},e);var t={teacherid:e.teacherid,currentPage:e.page,pageSize:e.row,isDraft:e.isDraft},n=$.Deferred();return $.getJSON("/video/videoList.htm",t,function(t){t.pageNumber=_.max([1,Math.ceil(+t.total/e.row)]),n.resolve(t)}),n.promise()},s=function(e){var t=$.Deferred();return $.post("/video/deleteVideo.htm",{videoId:e},function(e){"success"==e?(layer.msg("删除成功"),t.resolve()):layer.msg(e)}),t.promise()};return{init:function(){var a=this;e=$("#videolist .video_tag"),t=$("#myVideo-list"),n=yn.bootpag("#videolist"),n.on("page",function(e,t){i.page=t,a.render()}),e.on("click",".menu-item",function(){$(this).parent().find(".action").removeClass("select"),$(this).addClass("select"),i.page=1,i.isDraft=$(this).index(),a.render()}),t.on("click",".action-edit",function(){var e=$(this).parents("tr"),t=e.index()-1;$("#videolist").hide(),o.render(r[t])}),t.on("click",".action-delete",function(){var e=$(this).data("id");layer.confirm("确定要删除吗",function(t){s(e).done(function(){a.render()}),layer.close(t)})}),$("#ReleaseVideo").on("click",function(){$("#videolist").hide(),o.render()})},render:function(){a(i).done(function(e){if(e.rows.length<1)return void t.html("<p style='text-align:center;font-size:16px;margin:50px'>暂无内容</p>");r=e.rows;var o=["myVideo-template","myVideo-draft-template"][i.isDraft];t.html(template(o,e.rows)),n.bootpag({page:i.page,total:e.pageNumber})})}}}(),o=function(){function e(){var e=$("#titleInput").val(),t=$("#video_srcInput").val(),n=c.attr("src");if(""===e)return layer.msg("标题不能为空"),!1;if(""===t)return layer.msg("视频地址不能为空"),!1;if(""===n)return layer.msg("请上传视频封面"),!1;var r=$("#video_id").val(),o=$("#video_typeSelect").val(),a=$.trim(l.getContent());$("#album_idSelect").val();return{video_id:r,create_id:ynUserId,title:e,video_src:t,video_type:o,album_id:i.val(),album_course_sort:s.val(),image:n,content:a}}var t,n,i,o,a,s,c,d,l,p=function(e){e&&(o.val(e.title),d.val(e.video_id),a.val(e.video_src),n.val(e.video_type),i.val(e.album_id),s.val(e.album_course_sort),c.attr("src",e.image),l.setContent(e.content))},u=function(){$.getJSON("/video/videoTypeList.htm",function(e){var t="";_.forEach(e,function(e){t+="<option value="+e.type_id+">"+e.name+"</option>"}),n.append(t)}),$.getJSON("/video/frontAlbumList.htm",function(e){var t="";_.forEach(e,function(e){t+="<option value="+e.album_id+">"+e.title+"</option>"}),i.append(t)})},f=function(){$(".uploadBtn").on("click",function(){r.render({width:200,height:200})}),$("#save_draft").click(function(){var t=e();t&&(t.is_draft=1,$.post("/teacher/html/addEditVideo.htm",t,function(e){"success"==e?window.location.href="/backstage/myVideo.htm":layer.msg("视频发布失败, 请重试...")}))}),$("#save_publish").click(function(){var t=e();t&&(t.is_draft=0,$.post("/teacher/html/addEditVideo.htm",t,function(e){"success"==e?window.location.href="/backstage/myVideo.htm":layer.msg("视频发布失败, 请重试...")}))}),$("#close").click(function(){$("#videolist").show(),t.hide()})};return{init:function(){t=$("#postVideo"),n=$("#video_typeSelect"),i=$("#album_idSelect"),o=$("#titleInput"),a=$("#video_srcInput"),s=$("#album_course_sortInput"),c=$("#videoCover"),d=$("#video_id"),l=UE.getEditor("ueditContainer",{toolbars:[["fontsize","bold","forecolor","emotion","simpleupload"]],initialFrameHeight:200,elementPathEnabled:!1,wordCount:!1,enableContextMenu:!1,enableAutoSave:!1,pasteplain:!0}),u(),f()},render:function(e){this.reset(),t.show(),p(e)},reset:function(){$("#videoForm")[0].reset(),c.removeAttr("src"),d.val(""),l.setContent("")}}}()},function(e,t,n){"use strict";n(2),e.exports=function(){var e,t=function(){var t,n,i,o,a,s,c,d={width:200,height:200};$("body").append(r(d)),t=$("#myCropper-overlay"),t.height($(window).height()),n=$("#myCropper"),c=document.getElementById("myCropper-canvas");var l=c.getContext("2d"),p=new FileReader,u=n.find(".myCropper-btn-choose"),f=n.find(".myCropper-btn-upload");s=n.find(".myCropper-origin-image"),a=$("#myCropper-input-choose"),o=$(".myCropper-result-image"),i=n.find(".myCropper-content"),u.click(function(){a.click(),i.show(),h()}),t.on("click",".close",function(){return t.hide()&&h()}),a.change(function(e){var t=this.files[0];p.readAsDataURL(t)});var h=function(){$(c).data("state","no"),a.val(""),s.attr("src","").cropper("destroy"),l.clearRect(0,0,d.width,d.height),o.attr("src","")};return f.click(function(){if("no"==$(c).data("state"))return layer.msg("请先选择图片");var t=c.toDataURL();e.hide(),h(),e.onCrop(t)}),p.onload=function(e){var t=e.target.result,n="free"==d.ratio?NaN:d.width/d.height;s.attr("src",t).cropper({aspectRatio:n,viewMode:1,crop:function(e){l.clearRect(0,0,d.width,d.height),l.drawImage($(this)[0],e.x,e.y,e.width,e.height,0,0,d.width,d.height),$(c).data("state","yes")}})},{render:function(e){d.ratio=e.ratio,c.width=e.width,c.height=e.height,t.show()},hide:function(){return t.hide()},onCrop:function(){return console.log("onCrop回调方法没有实现")}}};return{getInstance:function(){return e||(e=t()),e}}}();var r=function(e){return'<div id="myCropper-overlay" class="hide">\n<div id="myCropper" class="line crop relative">\n    <span class="fa fa-times-circle absolute close"></span>\n    <div class="title">\n        <span class="myCropper-title">图片上传</span>\n    </div>\n    <div class="myCropper-content">\n        <div class="myCropper-content-left fl">  \n            <div class="myCropper-content-title">\n                <button class="myCropper-btn-choose btn">+选择图片</button>\n                <input type="file" class="hide" id="myCropper-input-choose" />\n            </div>\n            <div class="myCropper-origin">\n                <img class="myCropper-origin-image" style="max-width: 100%" />\n            </div>\n        </div>\n        <div class="myCropper-content-right fl">\n            <div class="title">图片预览</div>\n            <div class="thumb">\n                <canvas id="myCropper-canvas" width="'+e.width+'" height="'+e.height+'" data-state="no"></canvas>\n            </div>\n            <button class="myCropper-btn-upload btn">上传图片</button>\n        </div>\n    </div></div></div>'}},function(e,t,n){var r=n(3);"string"==typeof r&&(r=[[e.id,r,""]]);n(5)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(4)(),t.push([e.id,"#myCropper-overlay{position:fixed;top:0;width:100%;background:gray;background:rgba(0,0,0,.5);z-index:9999;text-align:center}#myCropper{position:relative;background:#fff;border-radius:4px;margin:auto;top:100px;box-shadow:8px 8px 15px rgba(0,0,0,.15);display:inline-block;overflow:hidden}#myCropper>.title{font-size:16px;margin-bottom:15px;text-align:left;padding:13px 20px;border-bottom:1px solid #dcdcdc}.myCropper-content{overflow:hidden;background:#fff;margin:30px;text-align:left}.myCropper-content-left{border-right:1px dashed #c7c7c7;padding-right:20px}.myCropper-btn-choose{font-size:13px;background:#000;border-color:#000;margin-bottom:10px}.myCropper-origin{width:400px;height:300px;background:#dcdcdc;overflow:hidden;float:left}.myCropper-content-right{margin-left:10px;padding-left:10px}.myCropper-content-right .title{font-size:16px}.myCropper-content-right .thumb{background:#dcdcdc;margin:10px 0}#myCropper-canvas{margin-left:auto;margin-right:auto;display:block}.myCropper-btn-upload{width:160px!important;padding:10px;font-size:15px}#myCropper-overlay .close{font-size:26px;right:10px;top:10px;cursor:pointer}",""])},function(e,t){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],t=0;t<this.length;t++){var n=this[t];n[2]?e.push("@media "+n[2]+"{"+n[1]+"}"):e.push(n[1])}return e.join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var r={},i=0;i<this.length;i++){var o=this[i][0];"number"==typeof o&&(r[o]=!0)}for(i=0;i<t.length;i++){var a=t[i];"number"==typeof a[0]&&r[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),e.push(a))}},e}},function(e,t,n){function r(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=f[r.id];if(i){i.refs++;for(var o=0;o<i.parts.length;o++)i.parts[o](r.parts[o]);for(;o<r.parts.length;o++)i.parts.push(d(r.parts[o],t))}else{for(var a=[],o=0;o<r.parts.length;o++)a.push(d(r.parts[o],t));f[r.id]={id:r.id,refs:1,parts:a}}}}function i(e){for(var t=[],n={},r=0;r<e.length;r++){var i=e[r],o=i[0],a=i[1],s=i[2],c=i[3],d={css:a,media:s,sourceMap:c};n[o]?n[o].parts.push(d):t.push(n[o]={id:o,parts:[d]})}return t}function o(e,t){var n=v(),r=b[b.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),b.push(t);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");n.appendChild(t)}}function a(e){e.parentNode.removeChild(e);var t=b.indexOf(e);t>=0&&b.splice(t,1)}function s(e){var t=document.createElement("style");return t.type="text/css",o(e,t),t}function c(e){var t=document.createElement("link");return t.rel="stylesheet",o(e,t),t}function d(e,t){var n,r,i;if(t.singleton){var o=y++;n=g||(g=s(t)),r=l.bind(null,n,o,!1),i=l.bind(null,n,o,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=c(t),r=u.bind(null,n),i=function(){a(n),n.href&&URL.revokeObjectURL(n.href)}):(n=s(t),r=p.bind(null,n),i=function(){a(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else i()}}function l(e,t,n,r){var i=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=x(t,i);else{var o=document.createTextNode(i),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(o,a[t]):e.appendChild(o)}}function p(e,t){var n=t.css,r=t.media;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function u(e,t){var n=t.css,r=t.sourceMap;r&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var i=new Blob([n],{type:"text/css"}),o=e.href;e.href=URL.createObjectURL(i),o&&URL.revokeObjectURL(o)}var f={},h=function(e){var t;return function(){return"undefined"==typeof t&&(t=e.apply(this,arguments)),t}},m=h(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),v=h(function(){return document.head||document.getElementsByTagName("head")[0]}),g=null,y=0,b=[];e.exports=function(e,t){t=t||{},"undefined"==typeof t.singleton&&(t.singleton=m()),"undefined"==typeof t.insertAt&&(t.insertAt="bottom");var n=i(e);return r(n,t),function(e){for(var o=[],a=0;a<n.length;a++){var s=n[a],c=f[s.id];c.refs--,o.push(c)}if(e){var d=i(e);r(d,t)}for(var a=0;a<o.length;a++){var c=o[a];if(0===c.refs){for(var l=0;l<c.parts.length;l++)c.parts[l]();delete f[c.id]}}}};var x=function(){var e=[];return function(t,n){return e[t]=n,e.filter(Boolean).join("\n")}}()},function(e,t){"use strict";yn.navigation.name=ynconfig.navigation.g,yn.logout.path="/index.htm",ynIsLogin||(setTimeout(function(){yn.login.render()},100),yn.login.onClose=function(){location.href="/index.htm"}),yn.centerMenu=function(){var e,t,n,r,i=function(e){return _.map(e,function(e){var t=_.trim(e.menuname)==r?"select":"";return'<a class="item '+t+'" id="'+e.menu_id+' " href="/'+e.menuurl+'">\n                    <span class="txt ">'+e.menuname+'</span>\n                    <i class="fa fa-angle-right "></i>\n                </a>'}).join("")};return{init:function(i){e=$("#centerMenu"),t=e.find(".items"),n=e.find(".title .name"),r=i.light||"",i.render&&this.render({type:i.render})},render:function(e){e=_.extend({type:"center"},e);var r={center:{title:"个人设置",url:"/menu/queryWebUserMenu.htm"},my:{title:"个人中心",url:"/menu/queryWebUserMyMenu.htm"}},o=r[e.type],a=o.url;n.text(o.title),new yn.loading({container:t,margin:200}).render(),$.getJSON(a,{user_id:ynUserId},function(e){return t.html(i(e))})}}}()}]);