"use strict";window._bd_share_config={common:{onBeforeClick:function(n,e){return e.bdText=$("#questionName").text()+"--【约牛网】",e.bdDesc=$("#questionName").text()+"--【约牛网】",e},onAfterClick:function(n){$(".bdsharebuttonbox").hide()}},share:{bdSize:24,bdStyle:1,bdCustomStyle:"/public/css/all.css"}};var chart={container:null,items:null,name:null,code:null,img:null,link:null,init:function(){this.container=$("#klineChart"),this.items=this.container.find(".content"),this.event()},render:function(n,e){if(n&&e){this.container.show(),this.code=e,this.name=n;var t=yn.stockPrefix(e),i={src:"http://image.sinajs.cn/newchart/min/n/"+t+".gif",code:e,name:n,href:"/marketLine.htm?stockcode="+e};this.items.html(template("chart-template",i))}},event:function(){var n=this;this.container.on("click",".addCustom",function(){if(!ynIsLogin)return void yn.login.render();var e={stockcode:n.code,stockname:n.name};yndata.addMyCustomStock(e)})}},bar={container:null,type:"ask",init:function(){this.container=$(".ask"),1==+ynIsTeacher&&(this.type="answer"),this.event()},render:function(n){var e=this,t={ask:"我要提问",answer:"我要解答",done:"已经回答",accept:"已经结束"},i=this.container.find(".questionCount");i.text(n.rows.questionCount);var o=_.pluck(n.rows.note_answer,"answeruserid");ynTeacherId&&_.indexOf(o,ynTeacherId+"")!=-1&&(e.type="done");var s=_.pluck(n.rows.note_answer,"is_adopt");s=_.reduce(s,function(n,e){return n-0+(e-0)},0),ynTeacherId&&s>0&&(e.type="accept");var a=this.container.find(".ask-title");a.text(t[this.type])},event:function(){var n=this;this.container.on("click",".column1",function(){$(this).find(".ask-title");return"done"===n.type?void layer.msg("回答过的不能再回答了"):ynIsLogin?"answer"===n.type&&1==+ynIsTeacher?void $("body").velocity("scroll",{duration:750,offset:1e4}):void n.delegate.click(n.type):void yn.login.render()})},delegate:{click:function(){}}},noteid=location.href.match(/id=([0-9]+)/)[1];$.post("/consultation/addNoteReadCount.htm",{noteid:noteid});var question=function(){var n,e,t=!1;return{stockCode:null,stockName:null,userId:null,data:null,init:function(){var i=this;n=$("#detailQuestion"),e=$(".bdsharebuttonbox"),n.on("click",".shareIcon",function(){yn.positionShare($(this))}).on("mouseleave",function(){setTimeout(function(){t||e.hide()},300)}),e.on("mouseenter",function(){t=!0}).on("mouseleave",function(){t=!1,e.hide()}),n.on("click","#inviteBtn",function(){var n={onlyInvite:!0,qUserId:$(this).data("userid"),qId:$(this).data("billno"),filter:_.uniq(_.map(i.answerData,function(n){return n.answeruserid}))};i.delegate.invite(n)})},render:function(){var e=this;yndata.queryNoteDetail(noteid).done(function(t){e.data=t,console.log("问题和回答",t),console.log("问题",t.rows.note[0]),qData=e.handleQuestion(t.rows.note[0]),qData._ancount=t.rows.note_answer_count,n.html(template("question-template",qData)),e.delegate.done(t)})},handleQuestion:function(n){return this.userId=n.questionuserid,this.stockCode=n.stockcode,this.stockName=n.stockname,n._questioncontent=yn.codeFormat(n.questioncontent),n.questiontime=yn.timeFormat(n.questiontime),n.questionCount=n.questionCount||0,n.note_source=["约牛WEB端","约牛iOS客户端","约牛安卓客户端"][+n.note_source],n},delegate:{done:function(n){},invite:function(n){}}}}(),answer=function(){var n,e;return{qUserId:null,hasAccept:!1,answerData:null,init:function(){var t=this;n=$("#askStockDetail"),e=n.find(".answer .items"),n.on("click",".action.help",function(){var n=$(this),e=n.parents(".item").index(),i=t.answerData[e];$.post("/consultation/answerZan.htm",{id:i.id},function(e){if("success"==e){var t=n.find(".txt");t.text(+t.text()+1)}"complete"==e&&layer.msg("您已经点过啦!"),0===+e&&layers.msg("参数为空")})}),n.on("click",".action.use",function(){var n=$(this);n.hide();var e=n.parents(".item").index(),i=t.answerData[e];$.post("/consultation/answerAdopt.htm",{id:i.id},function(n){"success"==n&&window.location.reload(),0===+n&&layers.msg("参数为空")})}),n.on("click",".line2 img",function(){yn.zoomImage($(this))})},render:function(n){this.answerData=this.handleData(n),console.log("回答",this.answerData),e.html(template("answer-template",this.answerData))},handleData:function(n){var t=this;return _.map(n,function(n){return n.answertime=yn.timeFormat(n.answertime),n.zancount=n.zancount||"0",n._liveStyle="0"==n.status?"":"hide",n.style=t.qUserId==ynUserId?"":"hide",n.acceptStyle="1"==n.is_adopt?"":"hide","1"==n.is_adopt&&(e.addClass("hasAccept"),t.hasAccept=!0),""===n.stock_trend&&(n.stock_trend=2),n.uplight=["light","hide","hide"][+n.stock_trend],n.downLight=["hide","light","hide"][+n.stock_trend],n})}}}();$(function(){var n=ynmodule.answerWindow();n.init();var e=ynmodule.askWindow();e.init(),question.init(),question.render(),question.delegate.done=function(t){var i=question.stockName,o=question.stockCode,s=question.userId;bar.init(),bar.render(t),bar.delegate.click=function(n){return ynIsLogin?void("ask"==n&&e.render({filter:_.uniq(_.map(t.rows.note_answer,function(n){return n.answeruserid}))})):void yn.login.render()},answer.init(),answer.qUserId=s,answer.render(t.rows.note_answer),chart.init(),chart.render(i,o);var a=new ynmodule.ReativeAsk;if(a.init(i,o),a.render(),1==+ynIsTeacher&&!answer.hasAccept){var r={stockCode:o,stockName:i,replys:_.pluck(t.rows.note_answer,"answeruserid"),number:t.rows.note[0].note_billno,answerCount:t.rows.note_answer_count};n.render(noteid,r)}},question.delegate.invite=function(n){e.render(n)}});