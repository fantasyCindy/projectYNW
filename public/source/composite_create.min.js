"use strict";$(function(){var e=$("#composite-intro textarea");yn.wordCount(e,{limit:100,indicate:$("#info-word-count")});var t=new ynUI.checkbox({container:$("#composite-style .checkboxs"),values:[{value:0,text:"保守型"},{value:1,text:"稳健性"},{value:2,text:"激进型"}]}).render(),n=new ynUI.checkbox({container:$("#max-life .checkboxs"),values:[{value:30,text:"30天"},{value:60,text:"60天"},{value:90,text:"90天"},{value:180,text:"180天"}],onChange:function(e){var t=a.val();if(t){var n=new yn.day(t);i.text(n.add(e[0]))}}}).render(),r=yn.calendar(),a=$("#beginTime"),i=$("#endTime");r.add(a,function(e){a.val(e.day);var t=new yn.day(e.day);i.text(t.add(n.getValues()[0]))});var o=new ynUI.slider({range:[-30,3],color:"green",container:$("#downline"),unit:"%",formatText:["-30%","3%"],onMove:function(e){e.result.val(e.range[0]+Math.ceil(e.sum*e.percent))}}).render(),c=new ynUI.slider({container:$("#income"),range:[5,100],unit:"%",color:"red",formatText:["5%","100%"],onMove:function(e){e.result.val(e.range[0]+Math.ceil(e.sum*e.percent))}}).render(),s=new ynUI.slider({range:[0,6400],container:$("#feedPrice"),color:"blue",unit:"牛币",onMove:function(e){e.result.val(e.range[0]+Math.ceil(e.sum*e.percent))}}).render();$(".slider .item").on("mouseenter",".doubt",function(){$(this).parents(".item").find(".slider-tip").show()}).on("mouseleave",".doubt",function(){$(this).parents(".item").find(".slider-tip").hide()});(function(){var e=$("#mycrop"),t=document.getElementById("crop-canvas"),n=t.getContext("2d"),r=$("#crop-image"),a=new FileReader,i=e.find(".btn-fileUpload"),o=i.next(),c=e.find(".uploadButton"),s=e.find(".result"),l=$("#fCover"),d=e.find(".upload-wrap");i.click(function(){o.click(),s.hide(),d.show(),u()}),o.change(function(e){var t=this.files[0];a.readAsDataURL(t)});var u=function(){$(t).data("state","no"),o.val(""),r.attr("src",""),n.clearRect(0,0,160,90),l.attr("src","")};c.click(_.debounce(function(){return"no"==$(t).data("state")?void layer.msg("请先选择图片"):void $.post("/auth/user/ImgUpload.htm",{dataImg:t.toDataURL(),user_id:ynUserId},function(e){if("success"==e.status){layer.msg("图片上传成功"),r.cropper("destroy");var t=e.returnPath;d.hide(),s.show(),l.attr("src",t)}},"json")},2e3,{leading:!0,trailing:!1})),a.onload=function(e){var a=e.target.result;r.attr("src",a).cropper({aspectRatio:16/9,viewMode:3,crop:function(e){n.drawImage($(this)[0],e.x,e.y,e.width,e.height,0,0,160,90),$(t).data("state","yes")}})}})(),function(){function e(){var e=$("#fName"),r=$("#fCover"),l=$("#fIntro"),u=e.val();if(!u||u.length>20||u<4)return void layer.msg("组合标题4-20个字");var v=r.attr("src");if(!v)return void layer.msg("请上传组合封面");var m=l.val();if(!m||m.length<10)return void layer.msg("组合简介限制为10-100字字符");var f=a.val();if(!f)return void layer.msg("运行开始时间不能为空");var g=new yn.day(f).offset();if(g<0)return void layer.msg("运行开始时间不能小于当前时间");var p=i.text();if(!d.val())return void layer.msg("请填写瞄一眼价格");var h={combination_name:u,combination_des:m,combination_pic:v,combination_style:t.getValues()[0],combination_maxterm:n.getValues()[0],create_id:+ynUserId,teacherid:+ynTeacherId,starttime_str:f,endtime_str:p,stop_line:+o.result.val(),target_revenue:+c.result.val(),order_price:+s.result.val(),peep_price:peepPriceVal};$.post("/composite/compositeCreate.htm",h,function(e){if("success"!=e)throw"error : "+e;layer.msg("组合创建成功"),setTimeout(function(){location.reload()},1e3)})}var r=$(".submit"),l=r.find("button"),d=$("#peep_price");l.click(_.debounce(function(){e()},2e3,{leading:!0,trailing:!1})),d.change(function(){var e=+s.result.val(),t=_.min([100,.1*e]),n=+$(this).val();return 0===e?void $(this).val(0):void((n>t||n<1)&&($(this).val(""),layer.msg("最高为订阅价的0.1倍, 取值范围(1-100)")))})}()});