"use strict";var categorys=["","热门资讯","涨停揭秘","宏观要闻","个股资讯","重点新闻"],list=function(){function e(e){return e.map(function(e){return'<div class="item flex"><a href="'+e.link+'" target="_blank" class="title flex1">'+e.title+'</a><span class="small category">'+categorys[e.backnews_type]+'</span><span class="small time">'+e.create_time+'</span><span class="small action"><button class="delete" data-id="'+e.id+'">删除</button></div>'}).join("")}var t,n,i,o,s,a=1,l=12,r=function(){t.on("click",".delete",function(){var e=$(this).data("id");$.post("/backNews/deleteNews.do",{id:e},function(e){list.render()}),layer.confirm("您真的要删除吗?",function(t){$.post("/backNews/deleteNews.do",{id:e},function(e){console.log("delete action back : ",e),list.render(),layer.close(t)})})})};return{init:function(){t=$("#list"),n=t.find(".header"),i=t.find(".items"),s=yn.bootpag(t),s.on("page",function(e,t){a=t,list.render()}),r()},render:function(){t.show(),yndata.getNewsList({page:a,row:l}).done(function(t){console.log("列表",t),o=t.rows,i.html(e(t.rows)),s.bootpag({page:a,total:t.pageNumber})})}}}(),publish=function(){function e(){var e=!!u.val(),t=!!i.getContent();return e&&t}function t(){u.val(""),i.setContent(""),r="",o.attr("src",""),s.val("")}var n,i,o,s,a,l,r,c,u,d=new FileReader;d.onload=function(e){o.attr("src",e.target.result)};var f=function(){s.on("change",function(){var e=this.files[0];d.readAsDataURL(e)}),a.on("click",_.debounce(function(){if(!e())return void layer.msg("表单不能为空..");var n={backnews_type:c.val(),title:u.val(),content:i.getContent(),title_img:r};console.log("发布资讯内容",n),$.post("/backNews/createNewsHtml.do",n,_.debounce(function(e){console.log("发布返回值",e),"success"==e?(layer.msg("发布成功"),t()):layer.msg("发布失败"+e)},2e3,{leading:!0,trailing:!1}))})),l.on("click",function(){$.post("/backNews/uploadImg.do",{src:o.attr("src")},function(e){console.log("img upload back : ",e),"success"==e.flag?(layer.msg("上传成功"),r=e.returnPath):layer.alert("上传失败, 请重试")},"json")})};return{init:function(){n=$("#publish"),o=$("#thumb"),s=$("#file-upload-container"),a=$(".submit button"),l=$(".uploadBtn"),c=$("#category"),u=$("#news-title"),i=UE.getEditor("ueditContainer",{toolbars:[["undo","redo","bold","indent","snapscreen","underline","subscript","superscript","pasteplain","preview","horizontal","removeformat","mergeright","mergedown","deleterow","deletecol","splittorows","splittocols","splittocells","deletecaption","inserttitle","mergecells","deletetable","insertparagraphbeforetable","fontfamily","fontsize","paragraph","simpleupload","insertimage","edittable","edittd","link","emotion","insertvideo","justifyleft","justifyright","justifycenter","justifyjustify","forecolor","backcolor","insertorderedlist","insertunorderedlist","fullscreen","rowspacingtop","rowspacingbottom","insertframe","imagenone","imageleft","imageright","attachment","imagecenter","lineheight","background","inserttable","charts"]],initialFrameHeight:500,elementPathEnabled:!1,wordCount:!1,enableContextMenu:!1,enableAutoSave:!1,pasteplain:!0,autotypeset:{removeClass:!0,clearFontSize:!0,removeEmptyline:!0,removeEmptyNode:!1,autotypeset:!0,indentValue:"2em"}}),f()},render:function(){n.show()},pub:function(e){$.post("/backNews/createNewsHtml.do",e,_.debounce(function(e){"success"==e?(layer.msg("发布成功"),list.render()):layer.msg("发布失败"+e)}))}}}(),title=function(){function e(e){$(".content-child").each(function(){var t=$(this).attr("id");t==e?($(this).css("display","flex"),n[t].render()):$(this).hide()})}var t,n={list:list,publish:publish},i=function(){t.on("click",".item",function(){$(this).parent().find(".select").removeClass("select"),$(this).addClass("select"),e($(this).data("type"))})};return{init:function(){t=$(".title-1"),i()},render:function(){}}}();$(function(){publish.init(),list.init(),list.render(),title.init()});