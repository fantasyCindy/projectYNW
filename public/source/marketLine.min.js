"use strict";function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function drawKline(t,e){function n(){var t="red";this.up<0&&(t="#1aa31a");var e=Highcharts.dateFormat("%Y年%m月%d日",this.x);return'<span style="color:blue">'+e+"</span><br><span>开盘价：</span>"+this.open+"<br><span>最高价：</span>"+this.high+"<br><span>最低价：</span>"+this.low+"<br><span>收盘价：</span>"+this.close+"<br><span>前收价：</span>"+this.old+'<br><span>涨跌幅：</span><span style="color:'+t+'" >'+this.up+"%</span><br>"}function i(){if("收盘"==this.name){var t=r(this.point.x);return'<span style="font-weight:normal">'+t+'&nbsp;&nbsp;&nbsp;&nbsp;收盘&nbsp;:&nbsp;<span style="color:green">'+this.point.y+"</span></span>"}return"成交量"==this.name?"成交量&nbsp;:&nbsp;"+yn.setDecimal(this.point.y/1e4,2)+"万手":'<span style="color:gray">'+this.name+" : "+this.point.y+"</span>"}function o(t,e,n){var i,o=this.chart;return i=n.plotX+t>o.plotWidth?n.plotX+o.plotLeft-t-30:n.plotX+o.plotLeft+30,{x:i,y:60}}function r(t){return Highcharts.dateFormat("%Y年%m月%d日",t)}function a(t){return Highcharts.dateFormat("%Y-%m-%d",t)}var s,l=[],h=[],c=[],d=[],u=[];t.length;_.forEach(t,function(t){l.push([t[0],t[1],t[2],t[4],t[3],t[9],t[10]]),h.push([t[0],t[5]]),c.push([t[0],+yn.setDecimal(t[6],2)]),d.push([t[0],+yn.setDecimal(t[7],2)]),u.push([t[0],+yn.setDecimal(t[8],2)])});var p=$("#"+e).data("select"),m={chart:{showAxes:!0},title:{text:""},credits:{enabled:!1},legend:{enabled:!1,itemWidth:160,symbolWidth:0,useHTML:!0,labelFormatter:i},navigator:{enabled:!0,baseSeries:4},rangeSelector:{buttonTheme:{width:50,height:14,style:{fontSize:"smaller"}},inputBoxHeight:13,labelStyle:{color:"black",fontSize:"smaller"},inputStyle:{fontSize:"smaller"},selected:p,inputDateFormat:"%Y-%m-%d",buttons:[{type:"month",count:3,text:"三个月"},{type:"month",count:6,text:"半年"},{type:"year",count:1,text:"一年"},{type:"year",count:3,text:"三年"},{type:"all",text:"全部"}]},xAxis:{labels:{formatter:function(){return a(this.value)}},lineWidth:1,gridLineWidth:1,gridLineDashStyle:"dash",events:{afterSetExtremes:function(){var t=(this.chart.xAxis[0],this.chart.yAxis[0]);t.setExtremes(t.dataMin,t.dataMax)}},tickLength:10,tickPositioner:function(){var t=this.ordinalPositions.length,e=this.ordinalPositions[Math.round(t/4)],n=this.ordinalPositions[Math.round(2*t/4)],i=this.ordinalPositions[Math.round(3*t/4)],o=[this.min,e,n,i,this.max];return o}},yAxis:[{opposite:!1,lineWidth:0,gridLineDashStyle:"dash",height:"60%",startOnTick:!0,endOnTick:!0},(s={opposite:!1,height:"20",lineWidth:0,top:"70%"},_defineProperty(s,"height","25%"),_defineProperty(s,"gridLineDashStyle","dash"),_defineProperty(s,"offset",0),_defineProperty(s,"labels",{enabled:!1}),_defineProperty(s,"title",{text:"成交量"}),s)],tooltip:{borderColor:"green",positioner:o},plotOptions:{spline:{marker:{enabled:!1,radius:0},lineWidth:1,tooltip:{enabled:!1,pointFormat:""}},series:{dataGrouping:{enabled:!1},states:{hover:{enabled:!1}},turboThreshold:3e3}},series:[{type:"candlestick",data:l,name:"收盘",color:"#33AA11",upColor:"#DD2200",lineColor:"#33AA11",upLineColor:"#DD2200",keys:["x","open","high","low","close","old","up"],tooltip:{useHTML:!0,headerFormat:"",pointFormatter:n}},{type:"column",name:"成交量",data:h,yAxis:1,tooltip:{enabled:!0,pointFormatter:function(){return"成交量："+yn.setDecimal(this.y/1e4,2)+"万手<br>"}},minPointLength:2},{type:"spline",name:"MA5",color:"#d53668",data:c,tooltip:{enabled:!0,useHTML:!0,pointFormatter:function(){return'<span style="color:#CC3668">MA5：'+this.y+"</span><br>"}}},{type:"spline",name:"MA10",color:"#f49100",data:d,tooltip:{enabled:!0,pointFormatter:function(){return'<span style="color:#F06600">MA10：'+this.y+"</span><br>"}}},{type:"spline",name:"MA30",color:"#b42cfe",data:u,tooltip:{enabled:!0,pointFormatter:function(){return'<span style="color:#AA2CFE">MA30：'+this.y+"</span><br>"}}}]};new Highcharts.StockChart(e,m)}$(function(){var t=(ynUserId,new ynmodule.ReativeAsk),e={container:$("#stockInfo"),shareInfo:$("#shareInfo"),stockName:$("#stock_name"),stockCode:$("#page_stock_code"),up:$("#_up"),radio:$("#_radio"),now:$("#_now"),open:$("#_open"),high:$("#_high"),low:$("#_low"),dealCount:$("#_dealCount"),top:$("#_top"),yesterday:$("#_yesterday"),dealMoney:$("#_dealMoney"),bottom:$("#_bottom"),init:function(){var t=this;this.event(),yn.queryStock(stockcode,{handle:!0,color:!0}).done(function(e){t.render(e)})},render:function(e){this.stockCode.text(stockcode),this.stockName.text(e[0]),this.now.html(e[3]),this.up.html(e[33]),this.radio.html(e[34]),this.open.html(e[1]),this.yesterday.html(e[2]),this.high.html(e[4]),this.low.html(e[5]),this.dealCount.html(e[8]),this.dealMoney.html(e[9]),this.top.html(e[35]),this.bottom.html(e[36]);var n=this.now.find("span");n.text("￥"+n.text()),t.init(e[0],stockcode),t.render()},event:function(){var t=this;this.shareInfo.on("click","button",function(){return ynIsLogin?void yndata.addMyCustomStock({stockcode:t.stockCode.text(),stockname:t.stockName.text()}).done(function(){layer.msg("添加成功"),n.render()}):void yn.login.render()})}},n={visible:!1,container:$("#MyOptional"),items:null,data:null,init:function(){this.event(),this.items=this.container.find(".items"),ynIsLogin&&this.render()},render:function(){var t=this;this.visible||(this.container.show(),this.visible=!0),yndata.getMyCustomStock().done(function(e){t.data=e,t.items.html(template("MyOptional-template",e))})},event:function(){var t=this;this.container.on("click","button",function(){var e=$(this);return layer.confirm("确定要取消吗?",function(n){layer.close(n);var i=e.parents("tr").index()-1,o=t.data[i];yndata.removeMyCustomStock({stockcode:o.stockcode,stockname:o.stockname,id:o.stockid}).done(function(){t.render()})}),!1}),this.container.on("click","tr.body",function(){var e=$(this).index()-1,n=t.data[e].stockcode;window.location.href="/marketLine.htm?stockcode="+n})}},i={container:$("#articles"),init:function(){this.items=this.container.find(".items"),this.render()},render:function(){var t=this;yndata.getHotArticle({row:7}).done(function(e){e=_.map(e,function(t){return t.link_path=t.link_path.replace("http://101.201.41.116:8080/",""),t}),t.items.html(template("article-template",e))})}};(function(){var t=$(".tabBar"),e=$(".shareContainer");t.on("click","td",function(){var t=$(this).data("show");e.hide(),$("#"+t).show(),yn["switch"]($(this));var n=$(this).data("type");kline.render[n]()})})();e.init(),n.init(),i.init()});var kline=function(){function t(t,e,n){var i=[],o=t.length,r=o-1;return i[0]=t[r][0],i[1]=t[0][1],i[2]=function(){return _.max(_.map(t,function(t,e){return t[2]}))}(),i[4]=function(){return _.min(_.map(t,function(t,e){return t[4]}))}(),i[3]=t[r][3],i[5]=t[r][5],i[6]=t[r][6],i[7]=t[r][7],i[8]=t[r][8],i[9]=function(){if(e<1)return 0;var t=n[e-1];return t?t[t.length-1][3]:0}(),i[10]=+yn.setDecimal((i[3]-i[9])/i[3]*100,2),i}var e=[];weekLineData=[],monthLineData=[];var n=window.location.href.match(/\d{6}/);if(!n)return void layer.msg("股票代码错误");var i=n[0],o=function(t){return e.length>0?void t(e):void $.getJSON("/getStockInfoByCodeinser.htm?stockcode="+i,function(n){e=r(n),console.log(e),t(e)})},r=function(t){var e=[],n=1;return _.forEach(t,function(t){t=t.replace(/\[|\]|%/g,"").split(","),t=_.map(t,function(t){return t=parseFloat(t)}),t[0]=yn.switchTimestamp(t[0]);var i=new Date(t[0]),o=+i.getDay(),r=+i.getMonth(),a=+i.getFullYear();1==o&&n++,t[11]=n,t[12]=1e4*a+r,e.push(t)}),e},a=function(e){return weekLineData.length>0?void e(weekLineData):void o(function(n){var i=_.chain(n).groupBy(function(t){return t[11]}).map(function(e,n,i){return t(e,n,i)}).value();weekLineData=i,e(i)})},s=function(e){return monthLineData.length>0?void e(monthLineData):void o(function(n){var i=_.chain(n).groupBy(function(t){return t[12]}).map(function(e,n,i){return t(e,n,i)}).value();monthLineData=i,e(i)})};return{render:{day:function(){o(function(t){drawKline(t,"container_day")})},week:function(){a(function(t){drawKline(t,"container_week")})},month:function(){s(function(t){drawKline(t,"container_month")})}}}}(),originalDrawPoints=Highcharts.seriesTypes.column.prototype.drawPoints,seriesPointAttr;Highcharts.seriesTypes.column.prototype.drawPoints=function(){for(var t=Highcharts.merge,e=this,n=this.chart,i=e.points,o=i.length;o--;){var r=n.series[0].points[o];if(void 0!==r.open&&void 0!==r.close){var a=r.open<r.close?"#DD2200":"#33AA11";seriesPointAttr=t(e.pointAttr),seriesPointAttr[""].fill=a,seriesPointAttr.hover.fill=Highcharts.Color(a).brighten(.1).get(),seriesPointAttr.select.fill=a}else seriesPointAttr=t(e.pointAttr);i[o].pointAttr=seriesPointAttr}originalDrawPoints.call(this)},Highcharts.setOptions({global:{useUTC:!0,timezoneOffset:-480},lang:{rangeSelectorZoom:"范围：",rangeSelectorFrom:"从",rangeSelectorTo:"至",months:["01","02","03","04","05","06","07","08","09","10","11","12"],shortMonths:["01","02","03","04","05","06","07","08","09","10","11","12"],weekdays:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"]}});