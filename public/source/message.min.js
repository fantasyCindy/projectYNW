"use strict";$(function(){if(!ynIsLogin)return yn.login.render(),void(yn.login.onClose=function(){window.location.href="/index.htm"});var e=function(){var t=$(".body-menu"),n=t.find(".menu-item"),a=null;return n.click(function(){yn["switch"]($(this));var t=$(this).data("type");e.current=a[t],e.current.page=1,e.current.render()}),{current:null,init:function(){a={system:c,careNews:i,askStock:askStock,composite:l,refer:p},this.current=i}}}(),t=$("body"),n=($("#messeage"),$(".body-items")),a=yn.bootpag($(".body-content"));a.on("page",function(n,a){e.current.page=a,e.current.render(),t.velocity("scroll",{offset:0})});var r=new ynmodule.loading;r.container=n,r.margin=200;var i=function(){var e=15,t=function(t){$.getJSON("/app/getTeacherMessage.htm",{source:"0",pageSize:e,currentPage:i.page},function(e){t(e.data)})},o=[{name:"发布了直播",type:"直播",link:"/live/liveDetailLive.htm?teacherid="},{name:"回答了问股",type:"问股",link:"/consultation/askStockDetail.htm?id="},{name:"发表了观点",type:"观点",link:"/article/newDetail.htm?article_id="}],c=function(e){return _.map(e,function(e){var t=e.tmessagetype;return e._name=e.teacher.nickname+o[t].name,e._time=yn.timeFormat(e.createtime),e._photo=e.teacher.photo,e._type=o[t].type,e._content=e.content||e.tmessagetitle,e._link=o[t].link+e.urllink.match(/\d+$/)[0],e})};return{page:1,render:function(){var i=this;r.render(),t(function(t){console.log("消息数据",t);var r=c(t.list);if(r.length<1)return void n.html(ynconfig.none());n.html(template("news-template",r));var o=_.max([1,Math.ceil(+t.total/e)]);a.show().bootpag({page:i.page,total:o})})}}}(),o={row:15,param:{type:3,page:1,templateId:"askStock-template"},getData:function(e){var t=this;$.getJSON("/app/getMessage.htm",{source:"0",messagetype:t.param.type,currentPage:t.param.page,pageSize:t.row},function(t){e(t)})},render:function(){var e=this;r.render(),o.getData(function(t){console.log("消息"+e.param.type,t);var r=t.data.list;if(r.length<1)return n.html(ynconfig.none()),void a.hide();n.html(template(e.param.templateId,e.handleData(r)));var i=_.max([1,Math.ceil(t.data.total/e.row)]);a.show().bootpag({page:e.param.page,total:i})})},handleData:function(e){return _.map(e,function(e){var t=e.urllink.match(/\d+$/);return t&&(e._id=t[0]),e})}},c={page:1,render:function(){o.param={type:2,page:this.page,templateId:"system-template"},o.render()}},p={page:1,render:function(){o.param={type:4,page:this.page,templateId:"askStock-template"},o.render()}},l={page:1,render:function(){o.param={type:5,page:this.page,templateId:"askStock-template"},o.render()}};e.init(),i.render()});