"use strict";function showUser(){$("#teacherComposite").remove(),$("#userComposite").show(),userList().init().render()}function showTeacher(){$("#teacherComposite").show(),$("#userComposite").remove(),menuTeacher(),listTeacher.init().render()}var menuTeacher=function(){var e=$("#teacherComposite .switch");e.on("click","td.item",function(){yn["switch"]($(this)),listTeacher.render({cStatus:$(this).data("value"),currentPage:1})}),e.on("click","td.verify",function(){yn["switch"]($(this)),listTeacher.render({cStatus:"",currentPage:1,audit:"1",status:"0"})}),$("#teacherComposite").on("change","#menu-state",function(){listTeacher.render({cStatus:"",currentPage:1,audit:"1",status:$(this).val()})})},listTeacher=function(){var e,t,n,i=function(e,t){if(e._menu_state="状态",t.audit){var n=_.sortBy(['<option value="0">待审核</option>','<option value="2">驳回</option>'],function(e){var n=+e.match(/\d/)[0];return+t.status==n?-1:n});e._menu_state='<select id="menu-state">'+n.join("")+"</select>"}return e.rows=_.map(e.rows,function(e){return e._name=e.combination_name.substr(0,10)+"...",e._state=ynconfig.composite_state[+e.combination_status][1],e._link="/html/CompositeDetail.htm?"+e.teacherid+"ZHXQ"+e.combinationid,t.audit&&(e._state=["待审核","审核通过","驳回"][+e.status]),e._style=ynconfig.composite_style[e.combination_style][1],e._income=parseFloat(e.target_revenue),e}),e};return{init:function(){return e=$("#teacherComposite .list"),t=yn.bootpag($("#teacherComposite .page")),t.on("page",function(e,t){list.render({currentPage:t})}),n=new ynmodule.loading({container:e,type:3,margin:100}),e.on("click",".delete .fa",function(){var e=$(this),t={operType:"del",ids:$(this).data("id")};$.post("/combination/doOperateSelected.htm",t,function(t){if("success"!=t)throw t;layer.msg("删除成功"),e.parents("tr").remove()})}),this},render:function(o){var a=this,r={user_id:ynUserId,audit:"",status:"",type:1,cStatus:1,pageSize:20,currentPage:1};o&&_.extend(r,o),n.render(),$.getJSON("/composite/compositeList.htm",r,function(n){if(console.log("我的组合",n),n.rows.length<1)return t.hide(),void e.show().html(ynconfig.none({margin:100}));n=i(n,r),e.show().html(template("teacherComposite-template",n));var o=_.max([1,Math.ceil(+n.total/r.pageSize)]);t.show().bootpag({page:a.page,total:o})})}}}(),userList=function(){var e,t,n,i,o;return{init:function(){var a=this;return e=$("#userComposite .composite-items"),n=e.find(".items"),t=$("#userComposite .switch"),t.on("click",".item",function(){yn["switch"]($(this));var e=+$(this).data("value");a.render({cStatus:e})}),i=new ynmodule.loading({container:n,margin:100}),o=yn.bootpag(e),this},render:function(e){var t={user_id:ynUserId,audit:"",status:"",type:0,cStatus:1,pageSize:20,currentPage:1};e&&_.extend(t,e),i.render(),$.getJSON("/composite/compositeList.htm",t,function(e){console.log("我的组合",e);var i=handleCompositeData(e.rows);n.html(template("composite-item-template",i));var a=_.max([1,Math.ceil(+e.total/t.pageSize)]);o.bootpag({page:self.page,total:a})})}}};$(function(){return yn.centerMenu.init(),yn.centerMenu.render({type:"my"}),ynIsLogin?void("1"==ynIsTeacher?showTeacher():showUser()):void yn.login.render()});