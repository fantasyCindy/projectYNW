"use strict";function drawPie(e){var n={chart:{plotBackgroundColor:null,plotBorderWidth:0,plotShadow:!1},colors:["#ec5e1a","#f7ca36","#f70084","#6e38d5","#30b1d3"],credits:{enabled:!1},title:{text:null},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{dataLabels:{enabled:!1,distance:-50,style:{fontWeight:"bold",color:"white",textShadow:"0px 1px 2px black"}},showInLegend:!0,center:["25%","50%"]}},legend:{layout:"vertical",floating:!0,align:"right",verticalAlign:"top"},series:[{name:"总销售额",type:"pie",innerSize:"50%",data:[["投资内参",e.neican_price],["投资组合",e.zuhe_price],["课程",e.kecheng_price],["礼物",e.liwu_price],["打赏",e.dahsang_price]]}]};$("#myIcome-chart").highcharts(n)}var menu={container:$("#myWallet .myincome-tag"),myicome_type:$("#myWallet .myicome-type"),select:"myIncome",init:function(){var e=this;this.container.on("click","td",function(n){$(this).parent().find(".thisclass").removeClass("thisclass"),$(this).addClass("thisclass");var t=$(this).data("type");e.delegate.click(t),e.select=t,e.myicome_type.hide(),$("#"+e.select).show()})},delegate:{click:function(){}}},qlIndent={param_record:{startTime:"",endTime:"",orderState:"",type:"",source:"",orderNum:"",pageSize:10,currentPage:1},param_pay:{startTime:"",endTime:"",status:"",payMode:"",orderNum:"",pageSize:10,currentPage:1},currenttime:"",init:function(){var e=$("#indentquerystartTime"),n=$("#allmarketTime"),t=$("#indentqueryendTime"),r=$("#depositstartTime"),a=$("#depositendTime"),i=$("#recharge #pay_type"),o=$("#pay_status"),c=$("#indent_num"),d=$("#pay_num"),s=$("#indent_type"),u=$("#indent_status"),p=$("#indent_source"),m=$("#myIncome .inquire-btn"),l=$("#recharge .inquire-btn"),y=this,h=yn.calendar();h.add(n,function(e){n.val(e.month)}),h.add(e),h.add(t),h.add(r),h.add(a),$(document).on("focus","input",function(){$(this).html("")}),m.on("click",function(){y.param_record.startTime=e.val(),y.param_record.endTime=t.val(),y.param_record.orderState=u.val(),y.param_record.type=s.val(),y.param_record.source=p.val(),y.param_record.orderNum=c.val(),y.param_record.pageSize=10,y.param_record.currentPage=1,y.delegate.click_query_btn(y.param_record)}),l.on("click",function(){y.param_pay.startTime=r.val(),y.param_pay.endTime=a.val(),y.param_pay.status=o.val(),y.param_pay.payMode=i.val(),y.param_pay.orderNum=d.val(),y.param_pay.pageSize=10,y.param_pay.currentPage=1,y.delegate.query_pay(y.param_pay)}),$(document).on("keydown",function(e){var t=document.all?window.event:e;y.currenttime=n.val(),13==t.keyCode&&y.delegate.allmarke({currenttime:y.currenttime})})},delegate:{allmarke:function(){},click_query_btn:function(){},query_pay:function(){}}},marker={container:null,init:function(){this.container=$("#myIncome")},handle:function(e){return e.moneystatus="1"==ynIsTeacher?"销售":"消费",e},render:function(e){var n=this;yndata.getExpense(e).done(function(e){e=n.handle(e),n.container.find(".balance").html(e.balance),n.container.find(".totalmoney").html(template("totalmoney-template",e)),drawPie(e)})}},myIncome={container:null,init:function(){this.container=$("#myIncome"),this.container.on("click",".deposit-href",function(){judgePay.render()})},handle:function(e){return e.ytk=0!=e.ytk_count?"已退款"+e.ytk_count+"笔共"+e.ytk_price+"元，":"",e.yxf=0!=e.yxf_count?"已消费"+e.yxf_count+"笔共"+e.yxf_price+"元，":"",e.tkz=0!=e.tkz_count?"退款中"+e.tkz_count+"笔共"+e.tkz_price+"元，":"",e.dzf=0!=e.dzf_count?"待支付"+e.dzf_count+"笔共"+e.dzf_price+"元。":"",e.statisresult="统计查询结果："+e.ytk+e.yxf+e.tkz+e.dzf,e.payorder=_.map(e.payorder,function(e){return e.orderState=["待支付","已完成","已取消","退款中","已归款","已关闭","服务中"][+e.orderState],e.goodsType=["观点","组合","课程","内参","问股","直播"][+e.goodsType],e.pay_source=["WEB","IOS","ANDROID"][+e.pay_source],e}),e},render:function(e){var n=this;yndata.getExpense(e).done(function(e){n.handle(e),n.container.find(".statistics-result").html(e.statisresult),n.container.find("#indent-list").html(template("indent-list-template",e.payorder)),n.event.done(e.pageNumber)})},event:{done:function(){}}},recharge={container:null,init:function(){this.container=$("#recharge")},handle:function(e){return e.list=_.map(e.list,function(e){return 0==e.orderState&&(e.payMode=3),e.payMode=["支付宝","微信","暂未选择"][+e.payMode-1],e.orderState=["待支付","已完成","已取消","退款中","已归款","已关闭","服务中"][+e.orderState],e}),e},render:function(e){var n=this;yndata.payrecord(e).done(function(e){n.handle(e),n.container.find("#payrecord").html(template("payrecord-template",e.list)),n.event.done(e.pageNumber)})},event:{done:function(){}}};$(function(){var e=yn.bootpag("#myWallet");e.on("page",function(n,t){"myIncome"==menu.select&&(qlIndent.param_record.currentPage=t,myIncome.render(qlIndent.param_record)),"recharge"==menu.select&&(qlIndent.param_pay.currentPage=t,myIncome.render(qlIndent.param_pay)),e.bootpag({page:t})}),qlIndent.init(),qlIndent.delegate.allmarke=function(e){marker.render(e)},qlIndent.delegate.click_query_btn=function(e){myIncome.render(e)},qlIndent.delegate.query_pay=function(e){recharge.render(e)},marker.init(),marker.render(qlIndent.currenttime),myIncome.init(),myIncome.render(qlIndent.param_record),myIncome.event.done=function(n){e.bootpag({total:n})},recharge.init(),recharge.event.done=function(n){e.bootpag({total:n})},menu.init(),menu.delegate.click=function(e){"recharge"==e&&recharge.render(qlIndent.param_pay),"myIncome"==e&&myIncome.render(qlIndent.param_record)}}),$(function(){var e={container:$("#defray"),init:function(){this.event()},event:function(){var e=this;this.container.on("click",".finish-btn",function(){var n=e.container.find("#old_password").val(),t=e.container.find("#new_password1").val(),r=e.container.find("#confirm_password1").val(),a={old_password:n,new_password:t,confirm_password:r};yndata.defray(a)})},render:function(){this.container.show(),bootpag.hide()}},n={container:$("#forget"),init:function(){this.event()},event:function(){var e=this;this.container.on("click",".finish-btn",function(){var n=e.container.find("#new_password2").val(),t=e.container.find("#confirm_password2").val(),r=e.container.find("#phone").val(),a=e.container.find("#phoneCode").val();send={new_password:n,confirm_password:t,phone:r,phoneCode:a},yndata.forget(send)})},render:function(){this.container.show(),bootpag.hide()}},t={operateone:$("#myWallet #indent-list"),operatetwo:$("#myWallet .deposit-wrap"),init:function(){this.event()},event:function(){this.operateone.on("click",".operate",function(){var e=$(this).data("id");r.render(e)}),this.operatetwo.on("click",".operate",function(){var e=$(this).data("num");a.render(e)})}},r={container:$("#indentable"),init:function(){this.center(),this.event()},center:function(){var e=$(window).width(),n=$(window).height(),t=this.container.outerWidth(),r=this.container.outerHeight();this.container.css({left:(e-t)/2+"px",top:(n-r)/2+"px"})},event:function(){var e=this;this.container.on("click","> .close",function(n){e.container.hide()})},render:function(e){var n=this;yndata.incomeDetail(e).done(function(e){e.orderState=["未支付","已完成","已取消","退款申请","退款成功","订单关闭","服务中"][+e.orderState],n.container.html(template("indentable-template",e)).velocity("transition.expandIn",{duration:300})})}},a={container:$("#rechargetable"),init:function(){this.center(),this.event()},center:function(){var e=$(window).width(),n=$(window).height(),t=this.container.outerWidth(),r=this.container.outerHeight();this.container.css({left:(e-t)/2+"px",top:(n-r)/2+"px"})},event:function(){var e=this;this.container.on("click","> .close",function(n){e.container.hide()})},render:function(e){var n=this;yndata.rechargeDetails(e).done(function(e){0==e.orderState&&(e.payMode=3),e.orderState=["未支付","已支付","已取消","申请退款","退款成功","订单关闭"][e.orderState],e.payMode=["支付宝","微信","暂未选择"][+e.payMode-1],n.container.html(template("rechargetable-template",e)).velocity("transition.expandIn",{duration:300})})}};myIncome.init(),marker.init(),recharge.init(),yn.centerMenu.init(),yn.centerMenu.render({type:"my"}),r.init(),a.init(),t.init();var i=new ynmodule.JudgePay;i.init(),e.init(),n.init()}),yndata.getExpense=function(e){e=_.extend({teacherid:ynTeacherId,user_id:ynUserId,currentPage:1,pageSize:10,currenttime:"",startTime:"",endTime:"",orderState:"",orderNum:"",type:"",source:""},e);var n=$.Deferred(),t={user_id:e.user_id,teacherid:e.teacherid,pageSize:e.pageSize,currentPage:e.currentPage,currenttime:e.currenttime,startTime:e.startTime,endTime:e.endTime,orderState:e.orderState,orderNum:e.orderNum,type:e.type,source:e.source};return $.getJSON("/consumption/indexPay_consumptionDetail.htm",t,function(t){t.pageNumber=_.max([1,Math.ceil(+t.total/e.pageSize)]),n.resolve(t)}),n.promise()},yndata.payrecord=function(e){e=_.extend({userId:ynUserId,currentPage:1,pageSize:10,startTime:"",endTime:"",orderNum:"",status:"",payMode:""},e);var n=$.Deferred(),t={userId:e.userId,pageSize:e.pageSize,currentPage:e.currentPage,startTime:e.startTime,endTime:e.endTime,orderNum:e.orderNum,status:e.status,payMode:e.payMode};return $.getJSON("/consumption/rechargeList.htm",t,function(t){t.pageNumber=_.max([1,Math.ceil(+t.total/e.pageSize)]),n.resolve(t)}),n.promise()},yndata.indentDetail=function(){var e=$.Deferred();return $.getJSON("/consumption/pay_consumptionDetail.htm",{id:id},function(n){e.resolve(n)}),e.promise()},yndata.defray=function(e){e=_.extend({user_id:ynUserId},e);var n=$.Deferred(),t={user_id:e.user_id,old_password:e.old_password,new_password:e.new_password,confirm_password:e.confirm_password};return $.post("/useraccount/updatePay_useraccountPassword.htm",t,function(e){return"success"==e?void layer.msg("密码修改成功！"):void layer.msg("密码修改失败！")}),n.promise()},yndata.forget=function(e){e=_.extend({user_id:ynUserId},e);var n=$.Deferred(),t={user_id:e.user_id,new_password:e.new_password,confirm_password:e.confirm_password,phone:e.phone,phoneCode:e.phoneCode};return $.post("/useraccount/forgetUseraccountPassword.htm",t,function(e){return"success"==e?void layer.msg("密码修改成功！"):void layer.msg("密码修改失败！")}),n.promise()},yndata.rechargeDetails=function(e){var n=$.Deferred();return $.getJSON("/consumption/rechargeDetail.htm",{orderNum:e},function(e){n.resolve(e)}),n.promise()},yndata.incomeDetail=function(e){var n=$.Deferred();return $.getJSON("/consumption/pay_consumptionDetail.htm",{orderNum:e},function(e){n.resolve(e)}),n.promise()};