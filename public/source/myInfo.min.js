"use strict";$(function(){yn.centerMenu.init(),yn.centerMenu.render();var n={container:$("#personInfoBar"),titleBar:$(".titleBar"),condition:$("#signCondition"),data:null,init:function(){this.event(),this.render()},render:function(){var n=this;yndata.getPersonInfo().done(function(t){console.log("个人信息",t),n.container.show().html(template("personInfoBar-template",t)),n.data=t})},event:function(){var n=this;this.container.on("click",".editButton",function(){n.container.hide(),t.render(n.data)})}},t=function(){var t=$("#teacherRegister"),e=$(".favicons img"),i=$("#txtUserName"),o=$("#nickName"),a=$("#txtMobile"),r=$("#txtQQ"),c=$("#txtMail"),l=$("#select-province"),s=$("#select-city"),d=$("#phoneModify"),u=$("#btnSave"),v={none:function(){d.html("<button class='phone-state-none'>获取验证码</button>"),a.removeAttr("disabled")},modify:function(){var n=0;a.removeAttr("disabled"),d.html("<button class='phone-state-modify'>验证码已发送, <strong id='timeRemained'>60</strong>秒后重新获取</button>");var t=$("#timeRemained"),e=setInterval(function(){if(60===n)return clearInterval(e),e=null,void(m=v.none());var i=+t.text();t.text(--i),n++},1e3)},done:function(){a.attr("disabled","false"),d.html("<button class='phone-state-done'>修改</button>")}},m=v.none();yn.cropbox(function(n){var t={dataImg:n,updateEntity:!0,user_id:ynUserId};$.post("/auth/user/headImgUpload.htm",t,function(n){if(yn.log(n),"success"==n.status){var t=n.returnPath;e.attr("src",t),$(".upload-img").hide()}},"json")}),t.on("click","#btnCancel",function(){t.hide(),n.render()}),$("#modifyFaviconBtn").click(function(){$(".upload-img").show()}),t.on("click",".phone-state-done",function(){m=v.none()}),t.on("click",".phone-state-none",function(){var n=a.val();yn.isMobile(+n)&&(m=v.modify(),$.post("/sendPhoneCode.htm",{phone:n},function(n){"-1"===n&&layer.alert("短信发送失败，请重试!")}))}),u.click(function(){var n=_.trim(i.val()),t=function(){var n=_.trim(o.val());return/[\w\u4e00-\u9fa5]{2,20}/.test(n)}();if(!t)return void layer.msg("请输入有效的昵称");var d=r.val().trim();if(!d)return void layer.msg("QQ不能为空");var u=a.val().trim();if(!u)return void layer.msg("手机号不能为空");var v={user_id:ynUserId,username:n,nickname:o.val(),sex:$("input[name='sex']:checked").val(),phone:u,qq:d,email:c.val(),provinceid:l.val(),cityid:s.val(),photo:e.eq(0).attr("src")};$.post("/center/user/edit.htm",v,function(n){window.location.reload()})});var f=function(n){e.attr("src",n.photo),i.val(n.username),o.val(n.nickname),"1"==n.sex?$("#sex-male").attr("checked","true"):$("#sex-female").attr("checked","true"),n.phone&&(a.val(n.phone),m=v.done()),r.val(n.qq),c.val(n.email),l.val(n.provinceid),n.provinceid&&yndata.getCity(n.provinceid).done(function(t){s.html(t),n.cityid&&s.val(n.cityid)})};return{render:function(n){t.show(),f(n)}}}();n.init()});