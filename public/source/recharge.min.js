"use strict";$(function(){var e={container:$("#defray"),defraying:$("#defray .defray-ing"),defraywin:$("#defray .defray-win"),nextstep:$("#defray .defray-next"),defrayon:$("#defray .defray-online"),defray:$("#defray .defray-money"),amount:$("#defray #defray-amount"),ordernum:$("#defray .ordernum"),credit:$("#defray .credit"),orderNum:null,totalPrice:null,init:function(){var e=this;this.orderNum=e.getQueryString("orderNum");var r=e.getQueryString("pay_type");"0"==ynIsTeacher?e.defray.find(".payaccount").html(ynUserName):e.defray.find(".payaccount").html(ynTeacherName),this.event(),e.orderNum&&(e.defray.hide(),e.defrayon.show(),yndata.orderNumDetail({orderNum:e.orderNum}).done(function(a){e.totalPrice=a.totalPrice,e.ordernum.html(a.orderNum),e.credit.html(""+a.totalPrice+"元"),e.defrayon.find(".defray-type span").eq(r).click()}))},event:function(){var e=this;this.nextstep.on("click",function(){return e.totalPrice=Number(e.amount.val()),/^[1-9][0-9]*$/.test(e.totalPrice)?(e.defray.hide(),e.defrayon.show(),e.container.find(".process"),void yndata.rencharge(e.totalPrice).done(function(r){e.ordernum.html(r.data.orderNum),e.credit.html(r.data.totalPrice+"元"),e.orderNum=r.data.orderNum,e.render.wechat()})):void layer.msg("客官，真的不能再少了(╯﹏╰) !")}),this.defrayon.find(".defray-type").on("click","span",function(){var r=$(this).index();$(this).parent().find(".thisclass").removeClass("thisclass"),$(this).addClass("thisclass"),e.defrayon.find(".defraytag:eq("+r+")").show(),e.defrayon.find(".defraytag:eq("+r+")").siblings().hide();var a=$(this).data("type");e.render[a]()}),this.defrayon.on("click",".closewin",function(){window.close()})},render:{wechat:function(){e.defrayon.find(".wechatewm").attr("src","/web/webWxPayQrcode.htm?orderNum="+e.orderNum+"&width=308&height=308")},alipay:function(){yndata.alipay(e.orderNum).done(function(r){var r=JSON.parse(r);e.defrayon.find(".alpayifram").attr("src",r.drcodePayUrl),e.defrayon.find(".comlog").attr("href",r.accountPayUrl)})}},getQueryString:function(e){var r=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),a=window.location.search.substr(1).match(r);return null!=a?unescape(a[2]):null}};e.init(),yn.head()}),yndata.orderNumDetail=function(e){var r=$.Deferred();return $.post("/web/getPayOrderInfo.htm",{orderNum:e.orderNum},function(e){r.resolve(e)},"json"),r.promise()};