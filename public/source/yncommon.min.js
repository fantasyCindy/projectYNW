"use strict";window.yn={},yn.log=function(e){console.log(e)},yn.loading=function(e){_.extend(this,e)},yn.loading.prototype={container:null,type:2,margin:60,render:function(){var e='<div class="loading" style="text-align:center;"><img class="inline" style="margin:'+this.margin+'px 0;" src="/public/icons/loading'+this.type+'.gif"/></div>';this.container.html(e)}},yn.noteTypeTag=function(e){e=_.extend({select:-1},e);var n=ynconfig.noteType,t="";for(var r in n){var i=n[r],o=+r.match(/[0-9]/)[0],s=o==e.select?"select":"",a=r.match(/\d+/)[0];t+='<span class="item '+s+' askStock-category-item " data-id="'+a+'">'+i+"</span>"}return t},yn.referType=function(e){return e=_.extend({select:-1},e),_.map(ynconfig.referType,function(n,t){var r=e.select==t?"select":"";return'<span class="referType-item '+r+'" data-id="'+n.id+'">'+n.name+"</span>"}).join("")},yn.getAskStockCategory=function(e){e=_.extend({select:-1,hasAll:!0},e);var n=ynconfig.askStockCategory;return e.hasAll||(n=_.drop(n)),_.map(n,function(n){var t=n.id==e.select?"select":"";return n.id==-1&&(n.id=""),'<span class="item '+t+' askStock-category-item " data-id="'+n.id+'">'+n.name+"</span>"}).join("")},yn.opinionType=function(e){return e=_.extend({select:-1},e),_.map(ynconfig.opinionType,function(n,t){var r=e.select==t?"select":"";return'<span class="opinionType-item '+r+'" data-id="'+n.id+'">'+n.name+"</span>"}).join("")},yn.isNumber=function(e){e=String(e);for(var n=!0,t=0;t<e.length;t++){var r=/[0-9.]/.test(e[t]);r||(n=!1)}return n},yn.isMobile=function(e){e=String(e);var n=yn.isNumber(e);if(!n)return!1;var t=/^0?1[34578][0-9]{9}$/;return!!t.test(e)},yn.isMail=function(e){e=String(e);var n=/^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$/;return!!n.test(e)},yn.isWord=function(e){e=String(e);var n=/[\w0-9@$!\-]+/;return!!n.test(e)},yn.isCharacter=function(e){e=String(e);var n=(e.length,/[0-9a-zA-Z\u4E00-\u9FA5]+/);return!!n.test(e)},yn.isCard=function(e){e=String(e);var n=/(^[0-9]{15}$)|(^[0-9]{18}$)|(^[0-9]{17}([0-9]|X|x)$)/;return!!n.test(e)},yn.isPassword=function(e){var n=/[0-9]*[a-zA-Z]+[0-9]*/;return!!(n.test(e)&&e.length>=6)},yn.isStockCode=function(e){e=String(e);var n=/[036][0-9]{5}/;return!!n.test(e)},yn.inputVerify=function(e,n){var t=function(){return"string"==typeof e?$(e):e}();n=_.extend({borderColor:t.css("borderColor"),rightColor:"#00DD00",errorColor:"red",errorMsg:null,focus:function(){},blur:function(){}},n),function(e,n){n.focus(function(){var t=n.parent(),r=t.find(".error-msg");void 0===r.get(0)&&(r=t.parent().find(".error-msg")),r.hide(),n.data("verify","0").css("borderColor",e.borderColor),e.focus(n)})}(n,t),function(e,n){n.blur(function(){var t=n.parent(),r=t.find(".error-msg");void 0===r.get(0)&&(r=t.parent().find(".error-msg"));var i=function(t){t?n.data("verify","1").css("borderColor",e.rightColor):(r.show(),n.css("borderColor",e.errorColor))},o=e.blur(n);return o.hasOwnProperty("done")?void o.done(function(e){i(e)}):void i(o)})}(n,t)},yn.now=function(e){e=_.extend({pad:!1,join:!1},e);var n=new Date,t=Number(n.getDate()),r=Number(n.getMonth()+1),i=Number(n.getFullYear()),o=+n.getHours(),s=+n.getMinutes(),a=+n.getSeconds(),c=[i,r,t,o,s,a];return e.pad?(c=_.map(c,function(e){return e=_.padLeft(e,2,"0")}),e.join?c[0]+"-"+c[1]+"-"+c[2]+" "+c[3]+":"+c[4]+":"+c[5]:c):c},yn.setDecimal=function(e,n){var t=parseFloat(e);if(isNaN(t))return console.log("setDecimal error : "+e+" is not valid! "),e;if(n=_.extend({step:2,math:"floor"},n),0===t)return _.padRight("0.",n.step+2,"0");var r="";t<0&&(t=Math.abs(t),r="-");var i=+_.padRight("1",n.step+1,"0"),o=t*i;if(o<1)return String(e).match(/[0.]+[^0]/)[0];t=Math[n.math](o)/i;var s=String(t).split(".");return s.length<2&&(s[1]=""),s[1]=_.padRight(s[1],n.step,"0"),r+s.join(".")},yn.colorValue=function(e,n){var t="";return n=_.extend({suffix:"",left:Number(e),right:0,upColor:"red",lowColor:"#17cb17",display:e},n),n.left<=n.right&&(t='<span style="color:'+n.lowColor+'">'+n.display+n.suffix+"</span>"),n.left>n.right&&(t='<span style="color:'+n.upColor+'">'+n.display+n.suffix+"</span>"),t},yn.color=function(e,n){return n=_.extend({upColor:"#d53",lowColor:"#390",display:e,exp:function(){return+e>0}},n),n.exp()?'<span style="color: '+n.upColor+'">'+n.display+"</span>":'<span style="color:'+n.lowColor+'">'+n.display+"</span>"},yn.queryStock=function(code,ops){var defer=$.Deferred();ops=_.extend({handle:!1,color:!1},ops);var reg=/[0-9]{6,}/;if(!reg.test(String(code)))return yn.log("yn.queryStock : stock code is error..."),defer.reject();var prefixs={0:"sz",3:"sz",6:"sh"},prefix=prefixs[String(code).substr(0,1)];return $.ajax({cache:!0,url:"http://hq.sinajs.cn/list="+prefix+code,type:"GET",dataType:"script",success:function success(data){var res=eval("hq_str_"+prefix+code+'.split(",")');if(res.length<5)return defer.reject();if(0===parseInt(res[3])&&(res[3]=res[2]),ops.handle){res=_.map(res,function(e){var n=parseFloat(e);return 0===n?"---":n?yn.setDecimal(e):e}),res[33]=yn.setDecimal((res[3]-res[2])/res[2]*100),res[34]=yn.setDecimal(res[3]-res[2]),res[35]=yn.setDecimal(1.1*res[1]),res[36]=yn.setDecimal(.9*res[1]),res[8]=function(){return yn.setDecimal(res[8]/1e6)+"万手"}(),res[9]=function(){if("---"==res[9])return"---";var e=res[9]/1e4;return e=e>1e4?yn.setDecimal(e/1e4)+"亿元":yn.setDecimal(e)+"万元"}();var now=res[1];ops.color&&(res[1]=yn.colorValue(res[1],{right:res[2]}),res[3]=yn.colorValue(res[3],{left:res[34]}),res[4]=yn.colorValue(res[4],{right:now}),res[5]=yn.colorValue(res[5],{right:now}),res[33]=yn.colorValue(res[33],{suffix:"%"}),res[34]=yn.colorValue(res[34]),res[35]=yn.colorValue(res[35],{right:now}),res[36]=yn.colorValue(res[36],{right:now}))}defer.resolve(res)}}),defer.promise()},yn.stockPrefix=function(e){e=String(e);var n={0:"sz",3:"sz",6:"sh"};return n[e.substr(0,1)]+e},yn.MarketIndex=function(){var e=null,n=[],t=function(e){$.getJSON("/html/querySinaMarketData1.htm",function(t){e(_.map(["上证指数","深证成指","中小板指","创业板指"],function(e){return e=n(t.market[e])}))});var n=function(e){e.curdot=yn.setDecimal(e.curdot);var n=parseFloat(e.rate);return e.color=n>0?"red":"green",0===n&&(e.color="gray"),e}},r=function(e,n){return'<div id="mi-'+n+'-color" class="marketIndex-item '+e.color+'">\n                        <div class="line1">\n                            <span id="mi-'+n+'-name" class="name">'+e.name+'</span>\n                            <span id="mi-'+n+'-curdot"  class="curdot">'+e.curdot+'</span>\n                            <span class="icon"></span>\n                        </div>  \n                        <div class="line2">\n                            <span id="mi-'+n+'-curprice"  class="price">'+e.curprice+'</span>\n                            <span id="mi-'+n+'-rate"  class="rate">'+e.rate+"</span>\n                        </div>\n                    </div>"},i=function(e,n){if(!e||!n)return!1;var t=!0;return _.forEach(e,function(e,r){e!==n[r]&&(t=!1)}),t},o=function(){t(function(t){_.forEach(t,function(t,o){if(!i(t,n[o])){var s=r(t,o);e.find("td").eq(o).html(s),n[o]=t}})})};return{render:function(n,t){e=n,t=t||"line";var r={line:'<table class="line" id="MarketIndex"><tr><td></td><td></td><td></td><td></td></tr></table>',column:'<table class="column" id="MarketIndex"><tr><td></td><td></td></tr><tr><td></td><td></td></tr></table>'};e.html(r[t]),o(),setInterval(function(){o()},5e3)}}},yn.sliderMake=function(e){function n(n,r){e.find(".banner").eq(n).fadeOut(),e.find(".banner").eq(r).fadeIn(),o.get(0)&&t(r)}function t(e){o.find(".focus").removeClass("focus"),o.find(".item").eq(e).addClass("focus")}var r=e.find(".banner").length-1,i=0,o=e.find(".pageIndex");o.get(0)&&o.on("click",".item",function(){var t=e.find(".banner:visible").index(),r=$(this).index();n(t,r)});var s;e.hover(function(){clearInterval(s)},function(){s=setInterval(function(){var e;e=i+1>r?0:i+1,n(i,e),i=e},5e3)}).trigger("mouseleave")},yn.timestamp=function(){return(new Date).getTime()},yn.switchTimestamp=function(e){e=String(e);var n=Number(e.substr(0,4)),t=Number(e.substr(4,2))-1,r=Number(e.substr(6,7)),i=Date.parse(new Date(n,t,r));return i},yn.bootpag=function(e,n){n=_.extend({first:!0},n);var t=_.now(),r="#"+t,i='<ul id="'+t+'" class="ynpagination"></ul>',o=function(){return"string"!=typeof e?e:$(e)}();o.append(i);var s=$(r).bootpag({total:1,page:1,maxVisible:5,firstLastUse:n.first,first:"首页",last:"尾页",next:"下一页",prev:"上一页",leaps:!1});return s.hide=function(){return $(r).hide(),s},s.show=function(){return $(r).show(),s},s},yn.wordCount=function(e,n){n=_.extend({indicate:null,limit:200},n),e.keyup(_.debounce(function(){var e=$(this).val(),t=e.length,r=n.limit-t;t>n.limit&&(layer.msg("超出字数限制"),e=e.substr(0,n.limit),$(this).val(e),r=0),n.indicate&&n.indicate.text(r)},500))},yn.bodyScroll=function(e){e?$("body").css("overflow","auto"):$("body").css("overflow","hidden")},yn.verifyImgFile=function(e){return e?!!/\.(jpg|jpeg|png)$/.test(e)||(layer.alert("支持:jpg、jpeg、png文件格式"),!1):(layer.alert("没有选择文件"),!1)},yn.verifyPhoneCode=function(e,n){var t=$.Deferred(),r={phone:e,phoneCode:n};return $.post("/validPhoneCode.htm",r,function(e){"success"==e?t.resolve(!0):t.resolve(!1)}),t.promise()},yn.zoomImage=function(e){var n=function(){return"string"==typeof e?e:e.attr("src")}(),t=$("body"),r='<div id="ynPopImageOverlay"><div id="ynPopImage" style="width:80%;height:80%;margin:auto;"><img style="width:100%;" src="'+n+'"/></div></div>';t.append(r),yn.bodyScroll(!1);var i=($("#ynPopImage"),$("#ynPopImageOverlay"));i.click(function(){$(this).remove(),yn.bodyScroll(!0)})},yn.codeFormat=function(e){return e.replace(/\$+.+?\$+/g,function(e){var n=e.match(/[0-9]+/)[0];return'<a href="/marketLine.htm?stockcode='+n+'" target="_blank" data-code="'+n+'" class="yn-code">'+e+"</a>"})},yn.codeFormat2=function(e){var n=[],t=e.replace(/[0-9]{6}/g,function(e){var t=e.match(/[0-9]+/)[0],r=yn.isStockCode(t);return r?(n.push(t),'<a data-code="'+t+'" class="yn-code">'+e+"</a>"):e});return[t,n[0]]},yn.timeFormat=function(e){n=e.replace(/[^0-9]+/g,"-").split("-"),n=_.map(n,function(e,n){return e=+e});var n=new Date(n[0],n[1]-1,n[2],n[3],n[4],n[5]).getTime(),t=(new Date).getTime(),r=Math.floor((t-n)/1e3);if(r>259200){var i=e.match(/^[0-9]{4}-([0-9\-]+)/);return i?i[1]:e}if(r>86400){var o=Math.floor(r/86400);return o+"天前"}if(r>3600){var s=Math.floor(r/3600);return s+"小时前"}return Math.floor(r/60)+"分钟前"},yn.positionShare=function(e){var n=e.offset().top+e.outerHeight(),t=e.offset().left,r=$(".bdsharebuttonbox");r.show().css({top:n,left:t})},yn.filterHTML=function(e,n){if("string"!=typeof e)return e;n=_.extend({substr:0,discern:!1,trim:!1},n);var t=e.replace(/<.+?>/g,function(e){return e.indexOf("img")!=-1?"[图片]":""});if(n.substr>0&&(t=t.substr(0,n.substr)+"..."),n.discern&&(t=yn.codeFormat(t)),n.trim){var r=t.match(/[\u4E00-\u9FA5\w\d，。？！：:'"“”%-~\[\]]+/g);t=r.join("")}return t},yn.centerBox=function(e){var n=document.body.clientWidth,t=$(window).height(),r=document.body.clientHeight,i=_.min([t,r]),o=e.width(),s=e.height(),a=(n-o)/2+"px",c=(i-s)/2+"px";e.css({position:"fixed",left:a,top:c})},yn.stockIndex=function(){function e(e){var n="http://hq.sinajs.cn/rn="+yn.timestamp()+"&list=s_sh000001,s_sz399001,s_sh000300,hkHSI,int_dji";$.ajax({dataType:"script",cache:!0,url:n,success:function(n){e()}})}function n(e){var n=_.map(e,function(e){var n=+e[2]>0;return e=_.map(e,function(e,t){return t>0&&(e=yn.setDecimal(e),3==t&&(e+="%")),yn.color(e,{exp:function(){return n}})}),'<table class="stock-index-item">\n                    <tr><td colspan="2" class="name">'+e[0]+'</td></tr>\n                    <tr><td rowspan="2" class="value">'+e[1]+'</td><td class="price">'+e[2]+'</td></tr>\n                    <tr><td class="radio">'+e[3]+"</td></tr>\n                    </table>"}).join("");return'<div class="stock-index-container">'+n+"</div>"}return{getTags:function(t){e(function(){var e=[];e.push(_.take(hq_str_s_sh000001.split(","),4)),e.push(_.take(hq_str_s_sz399001.split(","),4)),e.push(_.take(hq_str_s_sh000300.split(","),4)),e.push(_.take(hq_str_int_dji.split(","),4)),t(n(e))})}}}(),yn.chain=function(e){this.fn=e,this.next=null},yn.chain.prototype={setNext:function(e){this.next=e},handle:function(){var e=this.fn.apply(this,arguments);return"next"==e?this.next&&this.next.handle.apply(this.next,arguments):e}},yn["switch"]=function(e){e.parent().find(".select").removeClass("select"),e.addClass("select")},yn.parseFaceCode=function(e){return e.replace(/\[face=([a-z]+)\]/g,'<img src="/public/icons/face/$1.gif" />')};